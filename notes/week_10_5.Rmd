---
title: "Fractional Factorial Designs"
subtitle: "Week 10 [4]"
output:
  tufte::tufte_handout:
    citation_package: natbib
    latex_engine: xelatex
link-citations: yes
header-includes:
- \usepackage[fontsize=14pt]{scrextend}
---

Reading: 8.1 - 8.2

```{r, include=FALSE}
def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
  x <- def.chunk.hook(x, options)
  ifelse(options$size != "normalsize", paste0("\n \\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})

knitr::opts_chunk$set(message = FALSE, warning = FALSE, size = "small", echo = FALSE, fig.margin = TRUE, fig.height = 5)
```

```{r}
library("dplyr")
library("ggplot2")
library("readr")
library("EBImage")
library("reshape2")
library("ggplot2")
library("tufte")
theme_set(theme_bw() + theme(legend.position = "bottom"))
```

The trouble with $2^{K}$ designs is that the number of samples required grows exponentially with the number of factors $K$. The differences between 4 and 7 factors doesn’t sound like a lot, but it’s the difference between 16 and 128 experimental runs.
Fractional factorial designs show how to study extra factors without having to make as many runs. There is no free lunch, but the tradeoffs that it creates are often worth it.

## Principles

There are two central ideas,

* Sparsity of Effects: It’s often safe to assume that high-order interactions are rare.

* Heredity: It is unusual for an interaction to be significant without the corresponding main effects also being significant. For example, it would be unusual to have $A \times B$ be significant without at least one of $A$ and $B$ being significant.

## Initial Exploration

Suppose we want to study $A, B$ and $C$, but we only have a budget of 4 runs. We need to choose four corners of the cube to sample.
Some choices are obviously bad. E.g., if we chose all the samples on one face, we wouldn’t see any variation in one factor.
Here’s an idea that will lead us on the right path. Recall our old notation,

| label | A | B |  AB |
|--- | --- | --- | --- |
| (1) | - | - | + |
| a | + | - | - |
| b | - | + | - |
| ab | + | + | + |

Acting on the sparsity of effects principle, let’s suppose that AB is null and invent a contrast for C that exactly matches AB. We’ll update the label to match the associated corner of the cube.

| label | A | B |  AB | C |
|---| --- | --- | --- | --- |
| (c) | - | - | + | + |
| a | + | - | - | - |
| b | - | + | - | - |
| abc | + | + | + | + |

We can visualize the sampled corners below. It seems like a reasonable choice of 4 corners.
This turns out to be a general strategy for subsetting the full design. But before then, we need to define some vocabulary.

## Vocabulary

* $2^{K - 1}$: This denotes a fractional factorial design where we take $\frac{1}{2}$ of the samples in a $2^{K}$ design.

* Aliases: Above, we assumed that AB was null. Suppose that it weren’t, though. Notice that the contrasts used for the pairs below are all equal,
\begin{align*}
	 \left[AB\right] &= \frac{1}{2}\left(c - a + b + abc\right) = \left[C\right] \\
		\left[BC\right] &= \frac{1}{2}\left(-c + a - b + abc\right) = \left[A\right] \\
		\left[AC\right] &= \frac{1}{2}\left(-c - a + b + abc\right) = \left[B\right]
\end{align*}

and we have no conclusive way of distinguishing between these *aliased* effects,
besides appeals to the hereditary principle or domain knowledge. To denote this
unidentifiability, we will use bracket notation, for example,
	
\begin{align*}
\left[A\right] &= A + BC
\end{align*}
	
* Generators: In the example, we set $C = AB$. Multiplying both sides by $C$ and using the fact that $C^2 = I$, we find $ABC = I$. The *word* ABC will be called the generator for this fraction `r margin_note("For those who are familiar, this has close ties with abstract algebra.")`.

* Complementary designs: The complementary fraction of a fractional factorial design are the corners on which we didn’t take samples. Often, if there are strong aliased effects in an initial fractional design, the complementary fraction will be run in the next experiment.

* Resolution: A fractional design has resolution $R$ if no $p$-factor is aliased with an effect containing less than $R - p$ factors.

| $R$ | $p$ | $< R - p$ | Interpretation |
|- | - | --- | ------- |
| 3 | 1 |  $\leq 2$ | Main effects aren't aliased with other main effects, but could be aliased with two-way interactions | 
| 4 | 1 | $\leq 3$ | Main effects aren't aliased with any other main effects or with any two-way interactions, but could be aliased with three-way interactions | 
|  | 2 | $\leq 2$ | Two-way interactions aren’t aliased with main effects.
| 5 | 1 | $\leq 4$ | Main effects aren’t aliased with other main effects, two-way, or three way interactions. | 
| | 2 | $\leq 3$ | Two-way interactions aren’t aliased with with main effects or two-way interactions. |

* Projection: In a fractional factorial, if we decided that we don’t care about a factor after all, we automatically end up with a $2 ^ {K - 1}$  full-factorial for free.

* Sequences: If we find a strong contrast for an aliased effect, it’s natural to try a follow-up experiment to resolve the ambiguity.